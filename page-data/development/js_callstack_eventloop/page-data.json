{"componentChunkName":"component---src-templates-blog-post-js","path":"/development/js_callstack_eventloop/","result":{"data":{"site":{"siteMetadata":{"title":"Another day","author":"[geniein]","siteUrl":"https://geniein.github.io","comment":{"disqusShortName":"","utterances":"JaeYeopHan/gatsby-starter-bee"},"sponsor":{"buyMeACoffeeId":"jbee"}}},"markdownRemark":{"id":"75dd07a2-108d-59b2-96aa-52884f62bbac","excerpt":"자바스크립트의 호출스택과 이벤트루프는 JS만들어진 App들이 어떻게 동작하는지 이해하는 핵심요소이다. 조금 더 효율적인 설명을 위해 내가 참고했던 자료들을 직접 들고와서 설명하고자 한다.\n(JavaScript’s Call Stack, Callback Queue, and Event Loop) , (How JavaScript works: an overview of the engine, the runtime, and the call stack…","html":"<p>자바스크립트의 호출스택과 이벤트루프는 JS만들어진 App들이 어떻게 동작하는지 이해하는 핵심요소이다.<br>\n조금 더 효율적인 설명을 위해 내가 참고했던 자료들을 직접 들고와서 설명하고자 한다.\n<strong>(JavaScript’s Call Stack, Callback Queue, and Event Loop) , (How JavaScript works: an overview of the engine, the runtime, and the call stack)</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADjUlEQVQ4y1WSe0xbZRjGn16clw0Mxss0U6aLMdkyHVmGRmMyWGI0zpgtgnEdydYoTF0kcyrIiC7GTGOyLSkkDBjMDRZhMOj99PS0pVfaroW2pxd6gwJrRwpjm4ZFNIbXA/zBeJMn3/33vd/7fLiXLMbC+Au4FatANirDcpxvZiSV76x0oWjRS1yDzyLku4+Mj4Hu+lU4mWvAvqSwWo87ulNYF/cSq8BstBK5sQrRdA9EA711yI481TI+/OgZTf9X4C3bpV7XDHJB7hlNX1eFAHz96apuoKAWNNq4HnhXAP479TyIAJrEhnioschgHDzoNpT/1t91yGTimP3p6PubKIKH6zuH2YbuUfru9xtLja36dxtaDfihnZWsB8aLMcNvhU7dIy77hDDQ2/NajA8vWp2xc5NTs3+n0+N0VtH0knDhBvmFQKL8/AR9qBijxkt2eX2nE3WdLskVI4/d7x1ZyzAxvA2MUiV+8jmC5o/uPXcy6dtuj2Mwm51eyuVuLXZ0NG0XgKIBR4Lv9+Wp332TuvReGTM0DN2QV0p0EZe/KVvLkCYeg5FTio9fEDLUDu6ZyWfuO2zWAZPJTE6nk9outu3AR5eKI6mbaVpaXPpv4Tb9M+mu+kk1hVZuXLJSLnqghsIQbVc40fLktZ6Wnal0MsgwOgXHsTNW61C2vf2XV3Z/uq8wEp/ILfx5l870Ban0RzeV1rFfv3k2gzLFtGTL3uo1l/WWAzgpmObxQBr0Nm+Oj6jfDvnVJT7HqSKnsfbxvxIvPrKghtThcsuyKf5ESZ3lHA45jQ8d1n2ML+LAl2lxwRvHVoHLDks/D4pwYAyojG850eYu6VQ6v9VbPAeJSKQ/DQRSJL7sJEnTdY9wwlGw7BAqBZ2cA34V2p8J0rfqV4Erb5c5gCNW4Ki9EDubN2GXbrMAQ5fKiuDoKFKpCeQyafTZhWy22ouIwrih7cDRjqT4tF6A9hI27m1YBRa++gHMJqPYZDSAY5lyjuNCgiF+h92mtFptcrfbLed5Xh4MBuUBQclYqGp0xF+t0mi3sQYGgkQbZX14ovTwGtBut0ttNhsslqHvLRYLCRCy2e1kMZspzPM0Pz9P+XyeZmcFzc1RLpcjr9d7zOfzwe/3S9d97KJd+6HVakQajRpKpWqHXqerNZtMnxmNxhqWNdS4XK6aWDRaEw6HVxSJRKoDgcBxhmFeZlkWwj7Rg7z/AWQNB7+qEaVOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"js\"\n        title=\"js\"\n        src=\"/static/46d9d93b4af7bab1c5485b8e4e73fa66/5a190/js-event-loop-explained.png\"\n        srcset=\"/static/46d9d93b4af7bab1c5485b8e4e73fa66/5a46d/js-event-loop-explained.png 300w,\n/static/46d9d93b4af7bab1c5485b8e4e73fa66/0a47e/js-event-loop-explained.png 600w,\n/static/46d9d93b4af7bab1c5485b8e4e73fa66/5a190/js-event-loop-explained.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n자바스크립트에서 코드가 동작하는 순서는 위 그림과 같다.</p>\n<h3 id=\"호출스택call-stack\" style=\"position:relative;\"><a href=\"#%ED%98%B8%EC%B6%9C%EC%8A%A4%ED%83%9Dcall-stack\" aria-label=\"호출스택call stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>호출스택(Call Stack)</h3>\n<p>호출스택이란 프로그램이 동작하기 위해 불러져서 처리되는 순서를 Stack형태의 데이터구조화 한것이다.\nStack은 LIFO(Last In First Out)이기에 데이터블럭을 밑에서 부터 쌓아 위로 빠져나가는 형태를 볼수 있다.\n밑에 예제 코드와 도식을 보면 알수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">*</span> y\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">printSquare</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> s <span class=\"token operator\">=</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">printSquare</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>먼저 이전 단원에서 알아본 실행컨텍스트를 생각해보고 밑에 Call Stack을 도식을 봐보도록 하겠습니다.\n예제 코드가 실행되면 먼저 <code class=\"language-text\">전역컨텍스트(anonymous)</code> Call Stack에 들어 갑니다. 그런 다음 <code class=\"language-text\">LexicalEnvironment</code>에 <code class=\"language-text\">EnvironmentRecord(Hoisting)</code>통해\n<code class=\"language-text\">multiply</code>과 <code class=\"language-text\">preintSquare</code>이 선언되고 구문 마지막의 <code class=\"language-text\">printSquare(5)</code>통해 printSquare라는 <code class=\"language-text\">함수 컨텍스트(Function Context)</code>생성 되고 이와 같은 과정을 반복합니다.<br>\n그럼 밑에있는 그림을 보면 <code class=\"language-text\">전역컨텍스트</code>가 Call Stack에 안들어가 있습니다. <code class=\"language-text\">전역컨텍스트</code>는 보통 시작과 끝이기에 생략해서 표현하곤 합니다.<br>\nStep1, 첫번째 함수컨텍스트인 printSquare(5)가 들어옵니다.<br>\nStep2, printSquare Context를 처리하는 중 multiply(x,x)라는 함수를 만나 또 다른 <code class=\"language-text\">함수 컨텍스트</code>(multiply(x,x))를 생성합니다. 그리고 <code class=\"language-text\">multiply Context</code>에서 return x * y 통해 5*5를 리턴하고 <code class=\"language-text\">multiply context</code>는 종료되며 사라집니다.\nStep3, s값은 25가 되고 console.log(s)를 통해 25가 출력됩니다.<br>\nStep4, <code class=\"language-text\">printSquare Context</code> 또한 종료되며 사라집니다.<br>\nStep5, 모든 Context가 종료되면서 Call Stack 또한 Empty가 됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPklEQVQoz6WT3aqCUBBG9/s/iUKCeCG9h4ngjRdpaf4dtdLUOmcdBzYS0k0D0drj981Ms039fhGKz2sJnRJ+Pp95nmdZNs/zm0az+lD4reh252EY+r6X8+PxuN/vwsMSwiQ13243ZP9mvpjtdDpdr1fhJElgpGmans9nbJRGwBHgGMfx5XJBrJqmGceRMj9LCJOsqmqaJsau6xoG2AKARgYEVNu2iDh3XYdH1gPzDDWMgLysgCSPYCzk382a0VEIA0nptm1ej6q7lWUpq8ZAXi6PpEyx0RmdbBLgp8qGATTbnaWhlCdc1zVN0/d93hDHcQzDCIIATb1EURRchJipojDs93vLsjzPowS82+0OhwNmCpEPw/B4PFLItu0oimjIhcmYihrMOS6xZmLNa4HcNkf11R/jtQr9Pn9m/eb/AQMAXrdGXXbrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ex1\"\n        title=\"Ex1\"\n        src=\"/static/d7c88d785b19da93aae77dfff983c660/2bef9/js-event-loop-explained-ex1.png\"\n        srcset=\"/static/d7c88d785b19da93aae77dfff983c660/5a46d/js-event-loop-explained-ex1.png 300w,\n/static/d7c88d785b19da93aae77dfff983c660/0a47e/js-event-loop-explained-ex1.png 600w,\n/static/d7c88d785b19da93aae77dfff983c660/2bef9/js-event-loop-explained-ex1.png 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"이벤트-루프event-loop\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84event-loop\" aria-label=\"이벤트 루프event loop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이벤트 루프(Event Loop)</h3>\n<p>자바스크립트는 단일 Thread 언어이다. 이는 <code class=\"language-text\">Call Stack</code>이 하나만 존재하기 때문이다. 하지만 자바스크립트가 구동하는 환경(Runtime)은 싱글 스레드가 아니다. 이벤트 루프가 동작하는 원리르 보면 알수 있다.\n이벤트 루프는 <code class=\"language-text\">Call Stack</code>에 처리할 코드가 없다면 이후 <code class=\"language-text\">Callback Queue(Task Queue)</code>을 조사하여 처리해야할 데이터가 있다면 <code class=\"language-text\">Call Stack</code>으로 보낸다.\n그렇다면 <code class=\"language-text\">Callback Queue</code> 데이터는 어떻게 생기는 것일까? 그건 <code class=\"language-text\">비동기 콜백(Asynchronous Callback)</code>에 의해서이다.\n<code class=\"language-text\">Call Stack</code>에서 대표적인 비동기함수인 setTimeout이 들어온 경우 <code class=\"language-text\">Call Stack</code>에서는 setTimeout이 종료되지만 이 함수는 비동기적으로 해야할 일이 <code class=\"language-text\">백그라운드</code>에서 동작중이다. 이후 처리가 완료되면 데이터를 <code class=\"language-text\">Callback Queue</code>로 보내고 <code class=\"language-text\">Call Stack</code>이 빌때까지 기달렸다가 Event Loop에 의해 호출된다.<br>\n하나 명확하게 알아야할 것은 <code class=\"language-text\">Call Stack</code>이 비워있어야만 있어야만 한다는 것이다.</p>\n<p><img src=\"/25d69572591487e453578d6aff3264f0/js-event-loop-explained-ex2.gif\" alt=\"event loop\"></p>\n<h3 id=\"이벤트-루프-예제\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84-%EC%98%88%EC%A0%9C\" aria-label=\"이벤트 루프 예제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이벤트 루프 예제</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'first'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">second</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'second'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'setTimeout'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//최소 4ms</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">rtn</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>rtn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>second<span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//result second, first, promise, setTimeout</span></code></pre></div>\n<p><code class=\"language-text\">Call Stack</code>에 setTimeout이 들어오고 (second, 3000)내용을 <code class=\"language-text\">백그라운드</code>에 보내고 <code class=\"language-text\">Call Stack</code>에서 바로 사라진다.\n그리고 3초 후 <code class=\"language-text\">백그라운드</code>에서 <code class=\"language-text\">Callback Queue</code>로 second()를 보내고 <code class=\"language-text\">Call Stack</code>이 비여있으므로 <code class=\"language-text\">Event Loop</code>가 second()를 <code class=\"language-text\">Call Stack</code>으로 보낸다.\nsecond()를 전달받은 <code class=\"language-text\">Call Stack</code>은 <code class=\"language-text\">second 함수 컨텍스트</code>를 생성하고 이를 처리한다.<br>\n<code class=\"language-text\">second 함수 컨텍스트</code>는 console.log를 통해 second를 출력하고 setTimeout에 의해 익명함수 setTimeout이 <code class=\"language-text\">백그라운드</code>로 보내진다.\n그리고 promise를 처리하고 <code class=\"language-text\">first 함수 컨텍스트</code>를 생성한다.<br>\n<strong>-promise는 resolve까지는 동기처리가 되고 then, catch는 비동기이기에 <code class=\"language-text\">백그라운드</code>로 값이 보내진다.</strong><br>\n<code class=\"language-text\">first 함수 컨텍스트</code>는 console.log로 first를 출력하고 종료되어 사라진다.\n<code class=\"language-text\">first 함수 컨텍스트</code>종료되면서 <code class=\"language-text\">second 함수 컨텍스트</code> 또한 종료되어 ‘Call Stack<code class=\"language-text\">은 비여있는 상태이다. 이때</code>Event Loop<code class=\"language-text\">는</code>Callback Queue<code class=\"language-text\">를 조사하고 여기에 쌓여있는 console.log('promise')와 console.log('setTimeout')을</code>Call Stack`으로 보낸다.<br>\n<strong>-Promise가 setTimeout보다 먼저 나오는 이유는 설계상 Callback Queue내부에 우선순위가 promise와 process에 있기 때문이다.</strong></p>","frontmatter":{"title":"Javascript의 호출스택과 이벤트루프","date":"March 30, 2022"}}},"pageContext":{"slug":"/development/js_callstack_eventloop/","previous":{"fields":{"slug":"/development/js_execution_context/"},"frontmatter":{"title":"Javascript의 실행 컨텍스트"}},"next":{"fields":{"slug":"/development/js_this/"},"frontmatter":{"title":"Javascript의 this"}}}},"staticQueryHashes":["2486386679","3128451518"]}